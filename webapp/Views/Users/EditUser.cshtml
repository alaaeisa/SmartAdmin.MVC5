@model SmartAdminMvc.Models.User

@{
    ViewBag.Title = "  تعديل كلمة المرور   ";
}


<section id="widget-grid" class="">
    <div class="row">
        <article class="col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget" id="wid-id-4" data-widget-editbutton="false" data-widget-custombutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                    <h2>@ViewBag.Title</h2>
                </header>
                <div>
                    <div class="jarviswidget-editbox">
                    </div>
                    <div class="widget-body no-padding">
                        <form action="" id="smartform" class="smart-form">

                            <fieldset>
                                <div class="row">
                                    <section class="col col-3" hidden>
                                        <label class="label "> كود المستخدم     <span style="color:red">&nbsp;*</span></label>
                                        <label class="input">
                                            <input type="text" name="UserId" id="UserId" value="@Model.UserId" readonly>
                                        </label>
                                    </section>
                                

                                    <section class="col col-3">
                                        <label class="label "> كلمه المرور القديمة     </label>
                                        <label class="input">
                                            <input type="password" name="Email" id="Email" value="">
                                        </label>
                                    </section>
                                    <section class="col col-3">
                                        <label class="label "> كلمه المرور الجديدة     <span style="color:red">&nbsp;*</span></label>
                                        <label class="input">
                                            <input type="password" name="PassWord" id="PassWord" value="">
                                        </label>
                                    </section>
                                    <section class="col col-3">
                                        <label class="label "> تاكيد كلمة المرور     <span style="color:red">&nbsp;*</span></label>
                                        <label class="input">
                                            <input type="password" name="PassWordConfirm" id="PassWordConfirm" value="">
                                        </label>
                                    </section>
                                    

                                </div>
                            </fieldset>
                            <footer>
                                <button type="button" onclick="SaveData();" class="btn btn-lg btn-info waves-effect waves-themed">
                                    <span class="fa fa-save"></span>
                                    حفظ البيانات
                                </button>
                            </footer>
                        </form>
                    </div>
                </div>
            </div>
        </article>
    </div>
</section>
@section pagespecific {


    <script type="text/javascript">
        $(document).ready(function () {
            loadDropDown();
            ValidateForm();
         //   SetDocNo();
            //  DrawTableinstalition(null);
        });
        function ValidateForm() {

            var validator = $("#smartform").validate({

                // Rules for form validation
                rules:
                {
                    Email: {
                        required: true
                    },
                    PassWord: {
                            required: true
                        },
                    PassWordConfirm: {
                        equalTo: "#PassWord"
                        }


                    },

                // Messages for form validation
                messages: {
                    Email: {
                        required: 'الرجاء ادخال قيمه'
                    },
                    PassWord: {
                        required: 'الرجاء ادخال قيمه'
                    },
                    PassWordConfirm: {
                        equalTo: '  يرجى ادخال كلمة المرور متطابقة'
                    }

                },

                // Ajax form submition
                submitHandler: function (form) {
                    $(form).ajaxSubmit({
                        success: function () {
                            $("#smartform").addClass('submited');

                            SaveJournal();
                        }
                    });
                },
                errorPlacement: function (error, element) {
                    error.insertAfter(element.parent());
                },
                invalidHandler: function (form, validator) {
                    var errors = validator.numberOfInvalids();
                    if (errors) {
                        validator.errorList[0].element.focus();
                    }
                }
            });


        }




             function loadDropDown() {
            debugger;
            $.ajax({
                url: "@Url.Action("GetData", "Users")",
                  //  "Sales/GetData",
                datatype: "JSON",
                type: "Get",
                success: function (data) {

                    for (var i = 0; i < data.length; i++) {
                        var opt = new Option(data[i].CompanyName );
                        opt.value = data[i].CompanyID;
                        $("#UserCompID").append(opt);
                    }
                }
            });

        }

        function Error() {



            $.smallBox({
                title: "لم تتم العملية ",
                content: "كلمة المرور القديمة  خطا",
                color: "Red",
                iconSmall: "fa fa-cloud",
                timeout: 5000

            });

        }
    function Saved() {



        $.smallBox({
            title: "تم بنجاح",
            content: "تم الحفظ   بنجاح .......",
            color: "Green",
            iconSmall: "fa fa-cloud",
            timeout: 5000

        });

    }

    function SaveData() {
        debugger;


        if (!($("#smartform").valid())) {
            return;
        }

        var master = {
            UserID: $('#UserID').val(),
            Email: $('#Email').val(),
            PassWord: $('#PassWord').val(),



        };

        $('#click').prop("disabled", true);

        $.ajax({
            type: 'POST',

            url: '@Url.Action("UpdateUser", "Users")',
            dataType: 'json',
            data: { master: JSON.stringify(master) },
            success: function (data) {


                if (data !== "Fail") {
                    if (data =="Fail2") {
                        Error();
                    } else {
                        Saved();
                        setTimeout(function () {
                            (window.location.href = data)
                        }, 500);
                    }
                

                } else {
                    $("#click").prop('disabled', false);
                   
                }
            },

            error: function (ex) {

                loadNotfy('SaveError', "3");
                setTimeout(function () {
                    $('#showimage').addClass('hide');
                    $("#clicked").prop('disabled', false);
                }, 3000);
            }

        });



    }

      @*function SetDocNo() {
            debugger;
            var x =@ViewBag.UserID;
            //$("#n_currency_coff").val(1);
          $("#UserID").val(x);
        }*@





    </script>
}